<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒã‚¹ãƒ«ãƒ¼ãƒˆ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®š</title>
<style>
  body { font-family: system-ui, Arial, sans-serif; margin: 20px; }
  .tab-button { margin-right:6px; padding:6px 10px; }
  .tab-button.active { font-weight:bold; border-bottom:2px solid #333; }
  .tab-content { display:none; margin-top:12px; }
  .tab-content.active { display:block; }
  .config-item { margin:16px 0; padding:12px; border:1px solid #ccc; border-radius:6px; }
  .config-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
  .section-title { font-weight:600; margin:16px 0 6px; }
  .inline-input { display:flex; align-items:center; gap:8px; margin:6px 0; }
  .inline-input input[type="text"] { width:320px; }
  .inline-input .short { width:160px; }
  .inline-input .mini { width:110px; }
  .list { margin-top:6px; }
  .row { display:flex; align-items:center; gap:8px; margin:6px 0; }
  .muted { color:#666; font-size:12px; }
  .topline { margin-top:14px; border-top:1px solid #eee; padding-top:10px; }
  .btn { padding:4px 8px; }
  .btn-small { padding:2px 6px; }
  .group-box { border:1px dashed #bbb; padding:10px; border-radius:6px; margin:8px 0; }
</style>
</head>
<body>

<h1>ãƒã‚¹ãƒ«ãƒ¼ãƒˆ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®š</h1>

<!-- å…±é€š API ã‚­ãƒ¼ -->
<div class="config-item">
  <div class="section-title">Google Maps APIã‚­ãƒ¼ï¼ˆå…±é€šï¼‰</div>
  <div class="inline-input">
    <input type="text" id="apiKeyCommon" placeholder="APIã‚­ãƒ¼ã‚’å…¥åŠ›" style="width:420px;">
  </div>
  <div class="muted">â€» ãƒ¬ã‚³ãƒ¼ãƒ‰ç”»é¢ãƒ»ä¸€è¦§ç”»é¢ã®ä¸¡æ–¹ã§å…±é€šåˆ©ç”¨ã—ã¾ã™</div>
</div>

<!-- ã‚¿ãƒ– -->
<div id="tabs">
  <button type="button" class="tab-button active" data-tab="record">ãƒ¬ã‚³ãƒ¼ãƒ‰ç”»é¢</button>
  <button type="button" class="tab-button" data-tab="list">ä¸€è¦§ç”»é¢</button>
</div>

<div id="tab-contents">
  <div class="tab-content active" id="tab-record">
    <div class="config-header">
      <div class="section-title" style="margin:0;">ãƒ¬ã‚³ãƒ¼ãƒ‰ç”»é¢ ç”¨ è¨­å®š</div>
      <div><button type="button" id="add-record-config" class="btn">ï¼‹ è¨­å®šè¿½åŠ </button></div>
    </div>
    <div class="record-configs"></div>
  </div>
  <div class="tab-content" id="tab-list">
    <div class="config-header">
      <div class="section-title" style="margin:0;">ä¸€è¦§ç”»é¢ ç”¨ è¨­å®š</div>
      <div><button type="button" id="add-list-config" class="btn">ï¼‹ è¨­å®šè¿½åŠ </button></div>
    </div>
    <div class="list-configs"></div>
  </div>
</div>

<!-- ä¿å­˜ -->
<div class="savebar">
  <button type="button" id="save" class="btn">ä¿å­˜</button>
  <span class="muted">â€» ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ä¿å­˜å†…å®¹ã‚’å‡ºåŠ›ã—ã¾ã™</span>
</div>

<!-- ================= Templates ================= -->

<!-- è¨­å®šãƒ–ãƒ­ãƒƒã‚¯ -->
<template id="config-template">
  <div class="config-item">
    <div class="config-header">
      <div class="muted">ã“ã®ãƒ–ãƒ­ãƒƒã‚¯ã¯ 1 ã¤ã®ã€Œè¨­å®šã€ã§ã™</div>
      <button type="button" class="remove-config btn-small">ï¼ è¨­å®šå‰Šé™¤</button>
    </div>

    <!-- ID -->
    <div class="inline-input">
      <label class="id-label"></label>
      <input type="text" class="recordOrViewId short" placeholder="">
    </div>

    <!-- GPX URL -->
    <div class="section-title topline">GPX URL</div>
    <div class="gpx-list list"></div>
    <button type="button" class="add-gpx btn-small">ï¼‹ è¿½åŠ </button>

    <!-- åŒºåˆ†ã‚»ãƒƒãƒˆï¼ˆè‰²ãƒªã‚¹ãƒˆã®ã¿ï¼‰ -->
    <div class="section-title topline">åŒºåˆ†ã‚»ãƒƒãƒˆï¼ˆè‰²é †ã®ã¿ï¼‰</div>
    <div class="types-list list"></div>
    <button type="button" class="add-type-set btn-small">ï¼‹ è¿½åŠ </button>

    <!-- ãã®ä»–è¨­å®šã¯å¾“æ¥é€šã‚Š -->
  </div>
</template>

<!-- å˜è¡Œãƒ†ãƒ³ãƒ—ãƒ¬ -->
<template id="row-text-template">
  <div class="inline-input">
    <input type="text" class="text-input" placeholder="">
    <button type="button" class="remove-btn btn-small">ï¼</button>
  </div>
</template>

<!-- GPX URL å°‚ç”¨ -->
<template id="gpx-item-template">
  <div class="inline-input">
    <input type="text" class="gpxUrl" placeholder="https://.../file.gpx">
    <button type="button" class="remove-btn btn-small">ï¼</button>
  </div>
</template>

<!-- åŒºåˆ†ã‚»ãƒƒãƒˆ -->
<template id="type-set-template">
  <div class="row">
    <div class="colors-wrapper">
      <div class="color-list list"></div>
      <button type="button" class="add-color btn-small">ï¼‹ è‰²è¿½åŠ </button>
      <button type="button" class="remove-color btn-small">ï¼ è‰²å‰Šé™¤</button>
      <button type="button" class="rainbow-color btn-small">ğŸŒˆ è™¹è‰²</button>
    </div>
    <select class="line-type mini">
      <option value="solid">å®Ÿç·š</option>
      <option value="dashed">ç ´ç·š</option>
      <option value="wave">æ³¢ç·š</option>
    </select>
    <select class="legend mini">
      <option value="true">å‡¡ä¾‹è¡¨ç¤ºã™ã‚‹</option>
      <option value="false">å‡¡ä¾‹è¡¨ç¤ºã—ãªã„</option>
    </select>
    <input type="text" class="icon-url" placeholder="ã‚¢ã‚¤ã‚³ãƒ³URL" style="width:220px;">
    <button type="button" class="remove-type-set btn-small">ï¼</button>
  </div>
</template>

<!-- è‰²ã‚¢ã‚¤ãƒ†ãƒ  -->
<template id="color-item-template">
  <div class="row">
    <input type="color" class="color-value" value="#ff0000">
    <button type="button" class="remove-color-btn btn-small">ï¼</button>
  </div>
</template>

<script>
document.addEventListener('DOMContentLoaded', () => {
  let currentTab = 'record';

  // ã‚¿ãƒ–åˆ‡æ›¿
  document.querySelectorAll('.tab-button').forEach(btn=>{
    btn.addEventListener('click',()=>{
      document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
      document.getElementById('tab-'+btn.dataset.tab).classList.add('active');
      currentTab = btn.dataset.tab;
    });
  });

  function addRowFromTemplate(wrapper, templateId, removerSelector='.remove-btn'){
    const t = document.getElementById(templateId).content.cloneNode(true);
    wrapper.appendChild(t);
    const row = wrapper.lastElementChild;
    const rm = row.querySelector(removerSelector);
    if(rm) rm.onclick=()=>row.remove();
    return row;
  }

  function addTypeSetRow(wrapper){
    const row = addRowFromTemplate(wrapper,'type-set-template');
    const colorList = row.querySelector('.color-list');

    const addColor = ()=>{
      const colorRow = addRowFromTemplate(colorList,'color-item-template','.remove-color-btn');
      colorRow.querySelector('.remove-color-btn').onclick=()=>colorRow.remove();
    };
    // åˆæœŸ2è‰²
    addColor(); addColor();

    row.querySelector('.add-color').onclick=addColor;
    row.querySelector('.remove-color').onclick=()=>{if(colorList.lastElementChild) colorList.lastElementChild.remove();};
    row.querySelector('.rainbow-color').onclick=()=>{
      const rainbow=['#FF0000','#FF7F00','#FFFF00','#00FF00','#0000FF','#4B0082','#8B00FF'];
      colorList.innerHTML='';
      rainbow.forEach(c=>{
        const colorRow = addRowFromTemplate(colorList,'color-item-template','.remove-color-btn');
        colorRow.querySelector('.color-value').value=c;
        colorRow.querySelector('.remove-color-btn').onclick=()=>colorRow.remove();
      });
    };
    row.querySelector('.remove-type-set').onclick=()=>row.remove();
    return row;
  }

  function addConfig(containerSelector){
    const container = document.querySelector(containerSelector);
    const t = document.getElementById('config-template').content.cloneNode(true);
    container.appendChild(t);
    const config = container.lastElementChild;

    const idLabel = config.querySelector('.id-label');
    const idInput = config.querySelector('.recordOrViewId');
    if(currentTab==='record'){idLabel.textContent='ãƒ¬ã‚³ãƒ¼ãƒ‰ID:'; idInput.placeholder='ãƒ¬ã‚³ãƒ¼ãƒ‰ID';}
    else{idLabel.textContent='ãƒ“ãƒ¥ãƒ¼ID:'; idInput.placeholder='ãƒ“ãƒ¥ãƒ¼ID';}

    config.querySelector('.remove-config').onclick=()=>config.remove();

    const gpxList=config.querySelector('.gpx-list');
    config.querySelector('.add-gpx').onclick=()=>addRowFromTemplate(gpxList,'gpx-item-template');
    addRowFromTemplate(gpxList,'gpx-item-template');
    addRowFromTemplate(gpxList,'gpx-item-template');

    const typeList=config.querySelector('.types-list');
    config.querySelector('.add-type-set').onclick=()=>addTypeSetRow(typeList);

    return config;
  }

  document.getElementById('add-record-config').onclick=()=>addConfig('.record-configs');
  document.getElementById('add-list-config').onclick=()=>addConfig('.list-configs');

  // åˆæœŸ 1ä»¶ãšã¤
  document.getElementById('add-record-config').click();
  document.getElementById('add-list-config').click();

  // ä¿å­˜ï¼ˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ï¼‰
  document.getElementById('save').onclick=()=>{
    const collectConfig=(scopeEl)=>{
      const cfgs=[];
      scopeEl.querySelectorAll('.config-item').forEach(cfg=>{
        const id=cfg.querySelector('.recordOrViewId')?.value||'';
        const gpxUrls=[...cfg.querySelectorAll('.gpx-list .gpxUrl')].map(i=>i.value).filter(Boolean);
        const types=[...cfg.querySelectorAll('.types-list .row')].map(r=>{
          const colors=[...r.querySelectorAll('.color-list .color-value')].map(c=>c.value);
          return {
            colors,
            line:r.querySelector('.line-type')?.value||'solid',
            legend:r.querySelector('.legend')?.value==='true',
            icon:r.querySelector('.icon-url')?.value||''
          };
        });
        cfgs.push({id,gpxUrls,types});
      });
      return cfgs;
    };
    const payload={
      apiKey: document.getElementById('apiKeyCommon').value||'',
      recordConfigs: collectConfig(document.getElementById('tab-record')),
      listConfigs: collectConfig(document.getElementById('tab-list'))
    };
    console.log('ä¿å­˜ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚µãƒ³ãƒ—ãƒ«å‡ºåŠ›ï¼‰:',payload);
    alert('ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã—ã¾ã—ãŸ');
  };
});
</script>

</body>
</html>
