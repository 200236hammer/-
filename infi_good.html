<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>è¨­å®šç”»é¢ï¼ˆãƒ•ãƒ«çµ±åˆç‰ˆï¼‰</title>
  <style>
    body {
      font-family: system-ui, Arial, sans-serif;
      margin: 20px;
    }

    .tab-button {
      margin-right: 6px;
      padding: 6px 10px;
    }

    .tab-button.active {
      font-weight: bold;
      border-bottom: 2px solid #333;
    }

    .tab-content {
      display: none;
      margin-top: 12px;
    }

    .tab-content.active {
      display: block;
    }

    .config-item {
      margin: 16px 0;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    .config-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .section-title {
      font-weight: 600;
      margin: 16px 0 6px;
    }

    .inline-input {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 6px 0;
    }

    .inline-input input[type="text"] {
      width: 320px;
    }

    .inline-input .short {
      width: 160px;
    }

    .inline-input .mini {
      width: 110px;
    }

    .list {
      margin-top: 6px;
    }

    .info-item {
      display: flex;
      align-items: center;
      gap: 6px;
      margin: 6px 0;
      border: 1px solid #ddd;
      padding: 6px;
      border-radius: 4px;
      flex-wrap: wrap;
    }

    .info-item .display-names-wrapper {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 6px 0;
    }

    label {
      margin-right: 6px;
    }

    .id-label {
      margin-right: 6px;
    }

    .btn {
      padding: 4px 8px;
    }

    .btn-small {
      padding: 2px 6px;
    }

    .group-box {
      border: 1px dashed #bbb;
      padding: 10px;
      border-radius: 6px;
      margin: 8px 0;
    }

    .muted {
      color: #666;
      font-size: 12px;
    }

    .topline {
      margin-top: 14px;
      border-top: 1px solid #eee;
      padding-top: 10px;
    }

    .savebar {
      margin-top: 16px;
      display: flex;
      gap: 8px;
    }
  </style>
</head>

<body>

  <h1>ãƒã‚¹ãƒ«ãƒ¼ãƒˆ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®š</h1>

  <!-- å…±é€š API ã‚­ãƒ¼ -->
  <div class="config-item">
    <div class="section-title">Google Maps APIã‚­ãƒ¼ï¼ˆå…±é€šï¼‰</div>
    <div class="inline-input">
      <input type="text" id="apiKeyCommon" placeholder="APIã‚­ãƒ¼ã‚’å…¥åŠ›" style="width:420px;">
    </div>
    <div class="muted">â€» ãƒ¬ã‚³ãƒ¼ãƒ‰ç”»é¢ãƒ»ä¸€è¦§ç”»é¢ã®ä¸¡æ–¹ã§å…±é€šåˆ©ç”¨ã—ã¾ã™</div>
  </div>

  <!-- ã‚¿ãƒ– -->
  <div id="tabs">
    <button type="button" class="tab-button active" data-tab="record">ãƒ¬ã‚³ãƒ¼ãƒ‰ç”»é¢</button>
    <button type="button" class="tab-button" data-tab="list">ä¸€è¦§ç”»é¢</button>
  </div>

  <div id="tab-contents">

    <!-- ãƒ¬ã‚³ãƒ¼ãƒ‰ç”»é¢ -->
    <div class="tab-content active" id="tab-record">
      <div class="config-header">
        <div class="section-title" style="margin:0;">ãƒ¬ã‚³ãƒ¼ãƒ‰ç”»é¢ ç”¨ è¨­å®š</div>
        <div>
          <button type="button" id="add-record-config" class="btn">ï¼‹ è¨­å®šè¿½åŠ </button>
        </div>
      </div>
      <div class="record-configs"></div>
    </div>

    <!-- ä¸€è¦§ç”»é¢ -->
    <div class="tab-content" id="tab-list">
      <div class="config-header">
        <div class="section-title" style="margin:0;">ä¸€è¦§ç”»é¢ ç”¨ è¨­å®š</div>
        <div>
          <button type="button" id="add-list-config" class="btn">ï¼‹ è¨­å®šè¿½åŠ </button>
        </div>
      </div>
      <div class="list-configs"></div>
    </div>

  </div>

  <!-- ä¿å­˜ -->
  <div class="savebar">
    <button type="button" id="save" class="btn">ä¿å­˜</button>
    <span class="muted">â€» ã„ã£ãŸã‚“ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ä¿å­˜å†…å®¹ã‚’å‡ºåŠ›ã—ã¾ã™</span>
  </div>

  <!-- ================= Templates ================= -->

  <!-- è¨­å®šãƒ–ãƒ­ãƒƒã‚¯ -->
  <template id="config-template">
    <div class="config-item">
      <div class="config-header">
        <div class="muted">ã“ã®ãƒ–ãƒ­ãƒƒã‚¯ã¯ 1 ã¤ã®ã€Œè¨­å®šã€ã§ã™</div>
        <button type="button" class="remove-config btn-small">ï¼ è¨­å®šå‰Šé™¤</button>
      </div>

      <!-- ID -->
      <div class="inline-input">
        <label class="id-label"></label>
        <input type="text" class="recordOrViewId short" placeholder="">
      </div>

      <!-- GPX URL -->
      <div class="section-title topline">GPX URL</div>
      <div class="gpx-list list"></div>
      <button type="button" class="add-gpx btn-small">ï¼‹ è¿½åŠ </button>

      <!-- åŒºåˆ†ã‚»ãƒƒãƒˆ -->
      <div class="section-title topline">åŒºåˆ†ã‚»ãƒƒãƒˆ</div>
      <div class="types-list list"></div>
      <button type="button" class="add-type-set btn-small">ï¼‹ è¿½åŠ </button>

      <!-- é™¤å»æ–‡å­—åˆ— -->
      <div class="section-title topline">é™¤å»æ–‡å­—åˆ—</div>
      <div class="removeStrs-list list"></div>
      <button type="button" class="add-removeStr btn-small">ï¼‹ è¿½åŠ </button>

      <!-- åœ°ç‚¹ã‚¯ãƒªãƒƒã‚¯è¡¨ç¤º -->
      <div class="section-title topline">åœ°ç‚¹ã‚¯ãƒªãƒƒã‚¯è¡¨ç¤º</div>
      <div class="pointKintone-list list"></div>
      <button type="button" class="add-pointKintone btn-small">ï¼‹ è¿½åŠ </button>

      <!-- ãƒ«ãƒ¼ãƒˆã‚¯ãƒªãƒƒã‚¯è¡¨ç¤º -->
      <div class="section-title topline">ãƒ«ãƒ¼ãƒˆã‚¯ãƒªãƒƒã‚¯è¡¨ç¤º</div>
      <div class="routeKintone-list list"></div>
      <button type="button" class="add-routeKintone btn-small">ï¼‹ è¿½åŠ </button>

      <!-- ãƒ¬ã‚³ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯æ¡ä»¶ï¼ˆä¹—è»Š/é™è»Šï¼‰ -->
      <div class="section-title topline">ãƒ¬ã‚³ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯æ¡ä»¶</div>
      <div class="group-box">
        <div class="section-title" style="margin-top:0;">ä¹—è»Šåœ°ç‚¹æ¡ä»¶</div>
        <div class="boarding-conds list"></div>
        <button type="button" class="add-boarding-cond btn-small">ï¼‹ è¿½åŠ </button>

        <div class="section-title" style="margin-top:12px;">é™è»Šåœ°ç‚¹æ¡ä»¶</div>
        <div class="alighting-conds list"></div>
        <button type="button" class="add-alighting-cond btn-small">ï¼‹ è¿½åŠ </button>
        <div class="muted">ä¾‹ï¼‰InfoWindowã«ã€Œä¹—è»Šã€ãŒå«ã¾ã‚Œã¦ã„ãŸã‚‰ã€kintoneã® <code>boarding_bus_stop</code> ã§ä¸€è‡´æ¤œç´¢</div>
      </div>

      <!-- GPX <name> â†” kintone ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
      <div class="section-title topline">GPX &lt;name&gt; ã¨ kintoneãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å¯¾å¿œï¼ˆãƒ«ãƒ¼ãƒˆã‚¯ãƒªãƒƒã‚¯ç”¨ï¼‰</div>
      <div class="mapping-list list"></div>
      <div class="inline-input">
        <button type="button" class="add-mapping btn-small">ï¼‹ è¡Œè¿½åŠ </button>
        <button type="button" class="remove-mapping btn-small">ï¼ æœ«å°¾å‰Šé™¤</button>
      </div>

      <!-- 100mé»’ç·š -->
      <div class="inline-input topline">
        <label>è·é›¢100mæœªæº€é»’ç·š:</label>
        <select class="blackIfShort mini">
          <option value="true">ã™ã‚‹</option>
          <option value="false">ã—ãªã„</option>
        </select>
      </div>
    </div>
  </template>

  <!-- å˜è¡Œãƒ†ãƒ³ãƒ—ãƒ¬(æ±ç”¨) -->
  <template id="row-text-template">
    <div class="inline-input">
      <input type="text" class="text-input" placeholder="">
      <button type="button" class="remove-btn btn-small">ï¼</button>
    </div>
  </template>

  <!-- GPX URL å°‚ç”¨ -->
  <template id="gpx-item-template">
    <div class="inline-input">
      <input type="text" class="gpxUrl" placeholder="https://.../file.gpx">
      <button type="button" class="remove-btn btn-small">ï¼</button>
    </div>
  </template>

  <!-- åŒºåˆ†ã‚»ãƒƒãƒˆ -->
  <template id="type-set-template">
    <div class="row type-set-row">
    åŒºåˆ†å: <input type="text" class="type-name mini" placeholder="ä¾‹ï¼šé«˜é€Ÿãƒã‚¹">
      <!-- è‰²ãƒªã‚¹ãƒˆ -->
      <div class="colors-wrapper">
        <div class="color-list"></div>
        <button type="button" class="add-color btn-small">ï¼‹ è‰²è¿½åŠ </button>
        <button type="button" class="remove-color btn-small">ï¼ è‰²å‰Šé™¤</button>
        <button type="button" class="rainbow-color btn-small">ğŸŒˆ è™¹è‰²</button>
      </div>

      <select class="line-type mini">
        <option value="solid">å®Ÿç·š</option>
        <option value="dashed">ç ´ç·š</option>
        <option value="wave">æ³¢ç·š</option>
      </select>

      <select class="legend mini">
        <option value="true">å‡¡ä¾‹è¡¨ç¤ºã™ã‚‹</option>
        <option value="false">å‡¡ä¾‹è¡¨ç¤ºã—ãªã„</option>
      </select>

      <input type="text" class="icon-url" placeholder="ã‚¢ã‚¤ã‚³ãƒ³URL" style="width:220px;">
      <button type="button" class="remove-type-set btn-small">ï¼</button>
    </div>
  </template>

  <!-- è‰²è¡Œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ -->
  <template id="color-item-template">
    <div class="row color-row">
      è‰²: <input type="color" class="color-value mini" value="#ff0000">
    </div>
  </template>

  <!-- InfoWindow è¡¨ç¤ºè¡Œ -->
  <template id="info-item-template">
    <div class="info-item">
      <select class="data-source mini">
        <option value="kintone">kintone</option>
        <option value="gpx">GPX</option>
      </select>
      <input type="text" class="field-name mini" placeholder="é …ç›®å">
      <div class="display-names-wrapper">
        <input type="text" class="display-name mini" placeholder="è¡¨ç¤ºå">
        <button type="button" class="add-display-name btn-small">ï¼‹</button>
      </div>
      <button type="button" class="move-up btn-small">â†‘</button>
      <button type="button" class="move-down btn-small">â†“</button>
      <button type="button" class="remove-info-item btn-small">ï¼</button>
    </div>
  </template>

  <!-- ä¹—è»Š/é™è»Š æ¡ä»¶è¡Œ -->
  <template id="cond-item-template">
    <div class="row">
      ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: <input type="text" class="cond-key mini" placeholder="ä¾‹: ä¹—è»Š">
      ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ID: <input type="text" class="cond-field mini" placeholder="ä¾‹: boarding_bus_stop">
      <button type="button" class="remove-btn btn-small">ï¼</button>
    </div>
  </template>

  <!-- GPX <name> â†” ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å¯¾å¿œ è¡Œ -->
  <template id="mapping-item-template">
    <div class="row">
      GPX &lt;name&gt;: <input type="text" class="map-gpx mini" placeholder="ä¾‹: ä¹—è»Šãƒã‚¹åœ">
      â†’ kintoneãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: <input type="text" class="map-field mini" placeholder="ä¾‹: boarding_bus_stop">
      <button type="button" class="remove-btn btn-small">ï¼</button>
    </div>
  </template>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      let currentTab = 'record';

      // ---- ã‚¿ãƒ–åˆ‡æ›¿ ----
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
          currentTab = btn.dataset.tab;
        });
      });

      // ---- æ±ç”¨: ãã®å ´ã§è¿½åŠ ï¼†å‰Šé™¤ãƒœã‚¿ãƒ³ä»˜ä¸ ----
      function addRowFromTemplate(wrapper, templateId, removerSelector = '.remove-btn') {
        const t = document.getElementById(templateId).content.cloneNode(true);
        wrapper.appendChild(t);
        const row = wrapper.lastElementChild;
        const rm = row.querySelector(removerSelector);
        if (rm) rm.onclick = () => row.remove();
        return row;
      }

      // ---- InfoItem ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— ----
      function setupInfoItem(rowEl) {
        rowEl.querySelector('.remove-info-item').onclick = () => rowEl.remove();
        rowEl.querySelector('.move-up').onclick = () => {
          const prev = rowEl.previousElementSibling;
          if (prev) rowEl.parentNode.insertBefore(rowEl, prev);
        };
        rowEl.querySelector('.move-down').onclick = () => {
          const next = rowEl.nextElementSibling;
          if (next) rowEl.parentNode.insertBefore(next, rowEl);
        };
        rowEl.querySelector('.add-display-name').onclick = () => {
          const wrap = rowEl.querySelector('.display-names-wrapper');
          const input = document.createElement('input');
          input.type = 'text';
          input.className = 'display-name mini';
          input.placeholder = 'è¡¨ç¤ºå';
          wrap.insertBefore(input, rowEl.querySelector('.add-display-name'));
        };
      }

      // ---- åŒºåˆ†ã‚»ãƒƒãƒˆ è¿½åŠ  ----
      function addTypeSetRow(wrapper) {
        const row = addRowFromTemplate(wrapper, 'type-set-template', '.remove-type-set');
        setupTypeSet(row);
        return row;
      }

      // ---- åŒºåˆ†ã‚»ãƒƒãƒˆ è‰²æ“ä½œã‚»ãƒƒãƒˆ ----
      function setupTypeSet(typeRow) {
        const colorList = typeRow.querySelector('.color-list');

        // è‰²è¿½åŠ 
        typeRow.querySelector('.add-color').onclick = () => {
          addRowFromTemplate(colorList, 'color-item-template');
        };

        // è‰²å‰Šé™¤
        typeRow.querySelector('.remove-color').onclick = () => {
          if (colorList.lastElementChild) colorList.lastElementChild.remove();
        };

        // è™¹è‰²ãƒœã‚¿ãƒ³
        typeRow.querySelector('.rainbow-color').onclick = () => {
          const rainbow = ['#ff0000','#ffa500','#ffff00','#00ff00','#0000ff','#4b0082','#8b00ff'];
          colorList.querySelectorAll('.color-value').forEach((c,i)=>{
            c.value = rainbow[i % rainbow.length];
          });
        };

        // åˆæœŸ2è¡Œ
        addRowFromTemplate(colorList, 'color-item-template');
        addRowFromTemplate(colorList, 'color-item-template');
      }

      // ---- è¨­å®šãƒ–ãƒ­ãƒƒã‚¯ç”Ÿæˆ ----
function addConfig(containerSelector, isRecord = true) {
  const container = document.querySelector(containerSelector);
  const t = document.getElementById('config-template').content.cloneNode(true);
  container.appendChild(t);
  const config = container.lastElementChild;

  // ãƒ©ãƒ™ãƒ«ã«ãƒ¬ã‚³ãƒ¼ãƒ‰IDï¼ãƒ“ãƒ¥ãƒ¼IDã‚’è¨­å®š
  const idLabel = config.querySelector('.id-label');
  idLabel.textContent = isRecord ? 'ãƒ¬ã‚³ãƒ¼ãƒ‰ID:' : 'ãƒ“ãƒ¥ãƒ¼ID:';

  // å‰Šé™¤
  config.querySelector('.remove-config').onclick = () => config.remove();

  // åŒºåˆ†ã‚»ãƒƒãƒˆè¿½åŠ 
  const typesList = config.querySelector('.types-list');
  config.querySelector('.add-type-set').onclick = () => addTypeSetRow(typesList);

  // GPX
  const gpxList = config.querySelector('.gpx-list');
  config.querySelector('.add-gpx').onclick = () => addRowFromTemplate(gpxList, 'gpx-item-template');

  // é™¤å»æ–‡å­—åˆ—
  const removeStrsList = config.querySelector('.removeStrs-list');
  config.querySelector('.add-removeStr').onclick = () => addRowFromTemplate(removeStrsList, 'row-text-template');

  // InfoWindow è¡¨ç¤º
  const pointKintoneList = config.querySelector('.pointKintone-list');
  config.querySelector('.add-pointKintone').onclick = () => {
    const row = addRowFromTemplate(pointKintoneList, 'info-item-template', '.remove-info-item');
    setupInfoItem(row);
  };

  // ãƒ«ãƒ¼ãƒˆã‚¯ãƒªãƒƒã‚¯è¡¨ç¤º
  const routeKintoneList = config.querySelector('.routeKintone-list');
  config.querySelector('.add-routeKintone').onclick = () => {
    const row = addRowFromTemplate(routeKintoneList, 'info-item-template', '.remove-info-item');
    setupInfoItem(row);
  };

  // ä¹—è»Šæ¡ä»¶
  const boardingList = config.querySelector('.boarding-conds');
  config.querySelector('.add-boarding-cond').onclick = () => addRowFromTemplate(boardingList, 'cond-item-template');

  // é™è»Šæ¡ä»¶
  const alightingList = config.querySelector('.alighting-conds');
  config.querySelector('.add-alighting-cond').onclick = () => addRowFromTemplate(alightingList, 'cond-item-template');

  // GPX <name> â†” ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  const mappingList = config.querySelector('.mapping-list');
  config.querySelector('.add-mapping').onclick = () => addRowFromTemplate(mappingList, 'mapping-item-template');
  config.querySelector('.remove-mapping').onclick = () => {
    if(mappingList.lastElementChild) mappingList.lastElementChild.remove();
  };

  return config;
}

// åˆæœŸã‚¿ãƒ–ç”Ÿæˆ
addConfig('.record-configs', true);
addConfig('.list-configs', false);

document.getElementById('add-record-config').onclick = () => addConfig('.record-configs', true);
document.getElementById('add-list-config').onclick = () => addConfig('.list-configs', false);


      // ä¿å­˜
      document.getElementById('save').onclick = () => {
        console.log('ä¿å­˜ãƒœã‚¿ãƒ³æŠ¼ä¸‹ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰');
        alert('ä¿å­˜å†…å®¹ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã•ã‚Œã¾ã™');
      };
    });
  </script>

</body>

</html>
